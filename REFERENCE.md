# Reference

<!-- DO NOT EDIT: This document was generated by Puppet Strings -->

## Table of Contents

### Functions

* [`cd4pe_deployments::approve_deployment`](#cd4pe_deploymentsapprove_deployment): Approve a "pending approval" active deployment to a protected environment.
* [`cd4pe_deployments::create_custom_deployment_event`](#cd4pe_deploymentscreate_custom_deployment_event): Add a log message as a task event when running a deployment
* [`cd4pe_deployments::create_git_branch`](#cd4pe_deploymentscreate_git_branch): Creates a git branch with the given branch name and commit SHA
* [`cd4pe_deployments::create_temp_node_group`](#cd4pe_deploymentscreate_temp_node_group): Create a temporary Puppet Enterprise node group
* [`cd4pe_deployments::decline_deployment`](#cd4pe_deploymentsdecline_deployment): Decline a "pending approval" active deployment to a protected environment.
* [`cd4pe_deployments::delete_git_branch`](#cd4pe_deploymentsdelete_git_branch): Delete a git branch on your VCS
* [`cd4pe_deployments::delete_node_group`](#cd4pe_deploymentsdelete_node_group): Delete a Puppet Enterprise node group
* [`cd4pe_deployments::deploy_code`](#cd4pe_deploymentsdeploy_code): Performs a Puppet Enterprise Code Manager deployment for the given environment
* [`cd4pe_deployments::evaluate_result`](#cd4pe_deploymentsevaluate_result): This is a generic helper function to be used with the result from cd4pe_deployments function calls.
It will take the result from the function call and return an error hash if an error occurred. If no
error occurred, the result is returned, saving the user from having to process the hash.
* [`cd4pe_deployments::get_cookie`](#cd4pe_deploymentsget_cookie): Get a CD4PE cookie to use APIs that don't support token auth
* [`cd4pe_deployments::get_git_branches`](#cd4pe_deploymentsget_git_branches): Lists git branches for a repository associated with the current deployment
* [`cd4pe_deployments::get_impact_analysis`](#cd4pe_deploymentsget_impact_analysis): Get information about a CD4PE Impact Analysis
* [`cd4pe_deployments::get_impact_analysis_csv`](#cd4pe_deploymentsget_impact_analysis_csv): Download the CSV report of an impact analysis run
* [`cd4pe_deployments::get_node_group`](#cd4pe_deploymentsget_node_group): Get information about a Puppet Enterprise node group
* [`cd4pe_deployments::get_pipeline`](#cd4pe_deploymentsget_pipeline): Get information about a CD4PE pipeline
* [`cd4pe_deployments::get_pipeline_trigger_event`](#cd4pe_deploymentsget_pipeline_trigger_event): Search which recent pipeline(s) match for a given commit SHA for a repository
* [`cd4pe_deployments::partition_nodes`](#cd4pe_deploymentspartition_nodes): Partition nodes in a node group
* [`cd4pe_deployments::pin_nodes_to_env`](#cd4pe_deploymentspin_nodes_to_env): Pin a list of nodes to Puppet Enterprise environment group
* [`cd4pe_deployments::run_puppet`](#cd4pe_deploymentsrun_puppet): Run Puppet using the Puppet Orchestrator for a set of nodes in a given environment
* [`cd4pe_deployments::search_impacted_nodes`](#cd4pe_deploymentssearch_impacted_nodes): Get information about the impacted nodes of a CD4PE Impact Analysis
* [`cd4pe_deployments::search_pipeline`](#cd4pe_deploymentssearch_pipeline): Search which recent pipeline(s) match for a given commit SHA for a repository
* [`cd4pe_deployments::update_git_branch_ref`](#cd4pe_deploymentsupdate_git_branch_ref): Update a given git branch's HEAD ref to a new commit SHA
* [`cd4pe_deployments::validate_code_deploy_status`](#cd4pe_deploymentsvalidate_code_deploy_status): This is a helper function to be used with the result from the `deploy_code` function.
It will take the result from a code deploy and return an error hash if an error occurred or if
any of the code deployments failed.
* [`cd4pe_deployments::wait_for_approval`](#cd4pe_deploymentswait_for_approval): Blocks further plan execution until the deployment is approved in CD4PE

### Plans

* [`cd4pe_deployments::cd4pe_job`](#cd4pe_deploymentscd4pe_job)
* [`cd4pe_deployments::direct`](#cd4pe_deploymentsdirect): This deployment policy will deploy a source commit to the Puppet environment
associated with the Deployment's configured node group and then run Puppet.
* [`cd4pe_deployments::eventual_consistency`](#cd4pe_deploymentseventual_consistency): This deployment policy will perform a Puppet code deploy of the commit
associated with a Pipeline run.
* [`cd4pe_deployments::feature_branch`](#cd4pe_deploymentsfeature_branch): This deployment policy plan will perform a code deployment of an environment that
matches the source branch for a commit.
* [`cd4pe_deployments::rolling`](#cd4pe_deploymentsrolling): This deployment policy will deploy the target control repository commit to
target nodes in batches.

## Functions

### <a name="cd4pe_deploymentsapprove_deployment"></a>`cd4pe_deployments::approve_deployment`

Type: Ruby 4.x API

Typically consumed inside the block passed into `wait_for_approval`.
Related: `decline_deployment`

#### Examples

##### Approve deployment

```puppet
approve_deployment("development", "coolUser123")
```

#### `cd4pe_deployments::approve_deployment(String $environment_name, String $username)`

Typically consumed inside the block passed into `wait_for_approval`.
Related: `decline_deployment`

Returns: `Hash` contains the results of the function
See [README.md]() for information on the CD4PEFunctionResult hash format
* result [Hash]:
  * success [Boolean] whether or not the operation was successful
* error [Hash] contains error information if any

##### Examples

###### Approve deployment

```puppet
approve_deployment("development", "coolUser123")
```

##### `environment_name`

Data type: `String`

The name of the Puppet environment to deploy. Does nothing if the specified environment is not protected.

##### `username`

Data type: `String`

The name of the user approving the deployment. The username does not have to be a CD4PE user.
Care should taken as the username is *not* validated as having special approval permissions.

### <a name="cd4pe_deploymentscreate_custom_deployment_event"></a>`cd4pe_deployments::create_custom_deployment_event`

Type: Ruby 4.x API

Add a log message as a task event when running a deployment

#### Examples

##### Display the message "Hello I am a cool message"

```puppet
create_custom_deployment_event("Hello I am a cool message")
```

#### `cd4pe_deployments::create_custom_deployment_event(String $message)`

The cd4pe_deployments::create_custom_deployment_event function.

Returns: `Hash` contains the results of the function
See [README.md]() for information on the CD4PEFunctionResult hash format
* result [Hash]:
  * success [Boolean] whether or not the operation was successful
* error [Hash] contains error information if any

##### Examples

###### Display the message "Hello I am a cool message"

```puppet
create_custom_deployment_event("Hello I am a cool message")
```

##### `message`

Data type: `String`

The message you'd like to display on the custom deployment event

### <a name="cd4pe_deploymentscreate_git_branch"></a>`cd4pe_deployments::create_git_branch`

Type: Ruby 4.x API

Creates a git branch with the given branch name and commit SHA

#### Examples

##### Create git branch "feature_carlscoolfeature" to commit c090ea692e67405c5572af6b2a9dc5f11c9080c0

```puppet
create_git_branch("CONTROL_REPO", "feature_carlscoolfeature", "c090ea692e67405c5572af6b2a9dc5f11c9080c0")
```

#### `cd4pe_deployments::create_git_branch(Enum["CONTROL_REPO", "MODULE"] $repo_type, String $branch_name, String $commit_sha, Optional[Boolean] $cleanup)`

The cd4pe_deployments::create_git_branch function.

Returns: `Hash` contains the results of the function
See [README.md]() for information on the CD4PEFunctionResult hash format
* result [Hash]:
  * success [Boolean] whether or not the operation was successful
* error [Hash] contains error information if any

##### Examples

###### Create git branch "feature_carlscoolfeature" to commit c090ea692e67405c5572af6b2a9dc5f11c9080c0

```puppet
create_git_branch("CONTROL_REPO", "feature_carlscoolfeature", "c090ea692e67405c5572af6b2a9dc5f11c9080c0")
```

##### `repo_type`

Data type: `Enum["CONTROL_REPO", "MODULE"]`

The type of repo to perform the operation on. Must be one of "CONTROL_REPO" or "MODULE".

##### `branch_name`

Data type: `String`

The name of the branch you want to create

##### `commit_sha`

Data type: `String`

The source commit SHA of the new branch

##### `cleanup`

Data type: `Optional[Boolean]`

Whether or not CD4PE should clean up the branch at the end of the deployment. Defaults to true

### <a name="cd4pe_deploymentscreate_temp_node_group"></a>`cd4pe_deployments::create_temp_node_group`

Type: Ruby 4.x API

Create a temporary Puppet Enterprise node group

#### Examples

##### Create temp node group with parent node group id '3ed5c6c0-be33-4c62-9f41-a863a282b6ae'

```puppet
$parent_node_group_id = "3ed5c6c0-be33-4c62-9f41-a863a282b6ae"
$test_environment = "development"
create_temp_node_group($parent_node_group_id, $test_environment, true)
```

#### `cd4pe_deployments::create_temp_node_group(String $parent_node_group_id, String $environment_name, Optional[Boolean] $is_environment_node_group)`

The cd4pe_deployments::create_temp_node_group function.

Returns: `Hash` contains the results of the function
See [README.md]() for information on the CD4PEFunctionResult hash format
* result [Hash] Contains the new node group described by the following documentation:
  https://puppet.com/docs/pe/2019.1/groups_endpoint.html#response-format-01
* error [Hash] Contains error info if any was encountered during the function call

##### Examples

###### Create temp node group with parent node group id '3ed5c6c0-be33-4c62-9f41-a863a282b6ae'

```puppet
$parent_node_group_id = "3ed5c6c0-be33-4c62-9f41-a863a282b6ae"
$test_environment = "development"
create_temp_node_group($parent_node_group_id, $test_environment, true)
```

##### `parent_node_group_id`

Data type: `String`

The ID string of the parent node group

##### `environment_name`

Data type: `String`

The name of the environment to be associated with the temp node group

##### `is_environment_node_group`

Data type: `Optional[Boolean]`

A Boolean to indicate if the node group should be an environment node group. Defaults to 'true'.

### <a name="cd4pe_deploymentsdecline_deployment"></a>`cd4pe_deployments::decline_deployment`

Type: Ruby 4.x API

Typically consumed inside the block passed into `wait_for_approval`.
Related: `approve_deployment`

#### Examples

##### Decline approval

```puppet
decline_deployment("development", "coolUser123")
```

#### `cd4pe_deployments::decline_deployment(String $environment_name, String $username)`

Typically consumed inside the block passed into `wait_for_approval`.
Related: `approve_deployment`

Returns: `Hash` contains the results of the function
See [README.md]() for information on the CD4PEFunctionResult hash format
* result [Hash]:
  * success [Boolean] whether or not the operation was successful
* error [Hash] contains error information if any

##### Examples

###### Decline approval

```puppet
decline_deployment("development", "coolUser123")
```

##### `environment_name`

Data type: `String`

The name of the Puppet environment to deploy. Does nothing if the specified environment is not protected.

##### `username`

Data type: `String`

The name of the user declining the deployment. The username does not have to be a CD4PE user.
Care should taken as the username is *not* validated as having special approval permissions.

### <a name="cd4pe_deploymentsdelete_git_branch"></a>`cd4pe_deployments::delete_git_branch`

Type: Ruby 4.x API

Delete a git branch on your VCS

#### Examples

##### Delete git branch "development_b"

```puppet
delete_git_branch("CONTROL_REPO", "development_b")
```

#### `cd4pe_deployments::delete_git_branch(Enum["CONTROL_REPO", "MODULE"] $repo_type, String $branch_name)`

The cd4pe_deployments::delete_git_branch function.

Returns: `Object` success object
* success [Boolean] whether or not the operation was successful

##### Examples

###### Delete git branch "development_b"

```puppet
delete_git_branch("CONTROL_REPO", "development_b")
```

##### `repo_type`

Data type: `Enum["CONTROL_REPO", "MODULE"]`

The type of repo to perform the operation on. Must be one of "CONTROL_REPO" or "MODULE".

##### `branch_name`

Data type: `String`

The name of the branch you want to delete

### <a name="cd4pe_deploymentsdelete_node_group"></a>`cd4pe_deployments::delete_node_group`

Type: Ruby 4.x API

Delete a Puppet Enterprise node group

#### Examples

##### Delete node group 3ed5c6c0-be33-4c62-9f41-a863a282b6ae

```puppet
delete_node_group("3ed5c6c0-be33-4c62-9f41-a863a282b6ae")
```

#### `cd4pe_deployments::delete_node_group(String $node_group_id)`

The cd4pe_deployments::delete_node_group function.

Returns: `Hash` contains the results of the function
See [README.md]() for information on the CD4PEFunctionResult hash format
* result [Hash]:
  * success [Boolean] whether or not the operation was successful
* error [Hash] contains error information if any

##### Examples

###### Delete node group 3ed5c6c0-be33-4c62-9f41-a863a282b6ae

```puppet
delete_node_group("3ed5c6c0-be33-4c62-9f41-a863a282b6ae")
```

##### `node_group_id`

Data type: `String`

The ID string of the node group

### <a name="cd4pe_deploymentsdeploy_code"></a>`cd4pe_deployments::deploy_code`

Type: Ruby 4.x API

Performs a Puppet Enterprise Code Manager deployment for the given environment

#### Examples

##### Perform a code deploy of the 'development' environment

```puppet
$my_cool_environment = "development"
deploy_code($my_cool_environment)
```

#### `cd4pe_deployments::deploy_code(String $environment_name, Optional[String] $default_branch_override)`

The cd4pe_deployments::deploy_code function.

Returns: `Hash` contains the results of the function
See [README.md]() for information on the CD4PEFunctionResult hash format
* result [Array[Hash]] a list of deployment status objects described by the following documentation:
  https://puppet.com/docs/pe/latest/code_manager_api.html#response-format
* error [Hash] Contains error info if any was encountered during the function call

##### Examples

###### Perform a code deploy of the 'development' environment

```puppet
$my_cool_environment = "development"
deploy_code($my_cool_environment)
```

##### `environment_name`

Data type: `String`

The name of the Puppet environment to deploy

##### `default_branch_override`

Data type: `Optional[String]`

Specifies a default branch to set when performing a code deploy

### <a name="cd4pe_deploymentsevaluate_result"></a>`cd4pe_deployments::evaluate_result`

Type: Puppet Language

This is a generic helper function to be used with the result from cd4pe_deployments function calls.
It will take the result from the function call and return an error hash if an error occurred. If no
error occurred, the result is returned, saving the user from having to process the hash.

#### `cd4pe_deployments::evaluate_result(Hash $result_hash)`

The cd4pe_deployments::evaluate_result function.

Returns: `Variant` contains the results of the function

##### `result_hash`

Data type: `Hash`

The result hash of any cd4pe_deployments function call.

### <a name="cd4pe_deploymentsget_cookie"></a>`cd4pe_deployments::get_cookie`

Type: Ruby 4.x API

Get a CD4PE cookie to use APIs that don't support token auth

#### Examples

##### Get a cookie

```puppet
$cookie = get_cookie('user@domain.com', 'P@ssw0rd')
```

#### `cd4pe_deployments::get_cookie(String $login_user, String $login_pwd)`

The cd4pe_deployments::get_cookie function.

Returns: `Hash` contains the results of the function
See [README.md]() for information on the CD4PEFunctionResult hash format
* result [String] the cookie value
* error [Hash] contains error information if any

##### Examples

###### Get a cookie

```puppet
$cookie = get_cookie('user@domain.com', 'P@ssw0rd')
```

##### `login_user`

Data type: `String`

The CD4PE user login (email address)

##### `login_pwd`

Data type: `String`

The CD4PE user password

### <a name="cd4pe_deploymentsget_git_branches"></a>`cd4pe_deployments::get_git_branches`

Type: Ruby 4.x API

Lists git branches for a repository associated with the current deployment

#### Examples

##### List all branches for the control repo associated with the current deployment

```puppet
$branches = cd4pe_deployments::get_git_branches('CONTROL_REPO')
$branches.each |$branch| { out::message("Branch name: ${branch['name']} Head SHA: ${branch['sha']}") }
```

#### `cd4pe_deployments::get_git_branches(Enum["CONTROL_REPO", "MODULE"] $repo_type)`

The cd4pe_deployments::get_git_branches function.

Returns: `Hash` contains the results of the function
See [README.md]() for information on the CD4PEFunctionResult hash format
* result [Array] a list of git branches:
  * [Hash] a hash containing branch information
    * name [String] the name of the branch
    * sha  [String] the head SHA of the branch
* error [Hash] contains error information if any

##### Examples

###### List all branches for the control repo associated with the current deployment

```puppet
$branches = cd4pe_deployments::get_git_branches('CONTROL_REPO')
$branches.each |$branch| { out::message("Branch name: ${branch['name']} Head SHA: ${branch['sha']}") }
```

##### `repo_type`

Data type: `Enum["CONTROL_REPO", "MODULE"]`

The type of repo to perform the operation on. Must be one of "CONTROL_REPO" or "MODULE".

### <a name="cd4pe_deploymentsget_impact_analysis"></a>`cd4pe_deployments::get_impact_analysis`

Type: Ruby 4.x API

Get information about a CD4PE Impact Analysis

#### Examples

##### Get information about an Impact Analysis

```puppet
$ia = get_impact_analysis(2452)
```

#### `cd4pe_deployments::get_impact_analysis(Integer $id)`

The cd4pe_deployments::get_impact_analysis function.

Returns: `Hash` contains the results of the function
See [README.md]() for information on the CD4PEFunctionResult hash format
* result [Hash] of GetImpactAnalysis operation
* error [Hash] contains error information if any

##### Examples

###### Get information about an Impact Analysis

```puppet
$ia = get_impact_analysis(2452)
```

##### `id`

Data type: `Integer`

The internal ID of the Impact Analysis

### <a name="cd4pe_deploymentsget_impact_analysis_csv"></a>`cd4pe_deployments::get_impact_analysis_csv`

Type: Ruby 4.x API

Download the CSV report of an impact analysis run

#### Examples

##### Get the CSV for an Impact Analysis report as a string

```puppet
$ia_csv = get_impact_analysis_csv(2452)
```

#### `cd4pe_deployments::get_impact_analysis_csv(Integer $id)`

The cd4pe_deployments::get_impact_analysis_csv function.

Returns: `Hash` contains the results of the function
See [README.md]() for information on the CD4PEFunctionResult hash format
* result [Hash] of GetImpactAnalysisCsv operation
* error [Hash] contains error information if any

##### Examples

###### Get the CSV for an Impact Analysis report as a string

```puppet
$ia_csv = get_impact_analysis_csv(2452)
```

##### `id`

Data type: `Integer`

The internal ID of the Impact Analysis

### <a name="cd4pe_deploymentsget_node_group"></a>`cd4pe_deployments::get_node_group`

Type: Ruby 4.x API

Get information about a Puppet Enterprise node group

#### Examples

##### Get information about node group 3ed5c6c0-be33-4c62-9f41-a863a282b6ae

```puppet
$node_group = get_node_group_info("3ed5c6c0-be33-4c62-9f41-a863a282b6ae")
```

#### `cd4pe_deployments::get_node_group(String $node_group_id)`

The cd4pe_deployments::get_node_group function.

Returns: `Hash` contains the results of the function
See [README.md]() for information on the CD4PEFunctionResult hash format
* result [Hash]:
  * `name [String] name of the node group`
  * `id [String] the node group's id`
  * `description [String] a short description of the node group`
  * `environment [String] the name of the environment`
  * `environmentTrumps [Boolean] is this an environment group?``
  * `parent [String] the name of the parent node group`
  * `rule [Array] puppetDB rule`
  * `classes [Hash] list of classes assigned to this node group`
  * `configData [Hash] node group's configuration`
  * `nodes [Array] list of nodes pinned to this group`
* error [Hash] contains error information if any

##### Examples

###### Get information about node group 3ed5c6c0-be33-4c62-9f41-a863a282b6ae

```puppet
$node_group = get_node_group_info("3ed5c6c0-be33-4c62-9f41-a863a282b6ae")
```

##### `node_group_id`

Data type: `String`

The ID string of the node group

### <a name="cd4pe_deploymentsget_pipeline"></a>`cd4pe_deployments::get_pipeline`

Type: Ruby 4.x API

Get information about a CD4PE pipeline

#### Examples

##### Get information about a specific pipeline for 'control-repo'

```puppet
$pipeline = get_pipeline('CONTROL_REPO', 'control-repo', '14hf24zme79k00mcrknrbt23sb')
```

#### `cd4pe_deployments::get_pipeline(String $repo_type, String $repo_name, String $pipeline_id)`

The cd4pe_deployments::get_pipeline function.

Returns: `Hash` contains the results of the function
See [README.md]() for information on the CD4PEFunctionResult hash format
* result [Hash]:
  * `buildStage [String] info on the git change`
  * `id [String] the pipeline's id`
  * `name [String] the name of the pipeline`
  * `projectId [Hash] internal naming of the CD4PE repo`
  * `sources [Array] information about the source triggering the pipeline`
  * `stages [Array] information about all the stages in the pipeline, and their items`
* error [Hash] contains error information if any

##### Examples

###### Get information about a specific pipeline for 'control-repo'

```puppet
$pipeline = get_pipeline('CONTROL_REPO', 'control-repo', '14hf24zme79k00mcrknrbt23sb')
```

##### `repo_type`

Data type: `String`

The type of the repository (CONTROL_REPO or MODULE)

##### `repo_name`

Data type: `String`

The name of the repository

##### `pipeline_id`

Data type: `String`

The internal ID of the pipeline for this repository

### <a name="cd4pe_deploymentsget_pipeline_trigger_event"></a>`cd4pe_deployments::get_pipeline_trigger_event`

Type: Ruby 4.x API

Search which recent pipeline(s) match for a given commit SHA for a repository

#### Examples

##### Get pipeline trigger event for a repository named 'control-repo'

```puppet
$pipeline = get_pipeline_trigger_event('control-repo', '1mfxk3kc4ic1w0nny0zcq5l7cw', '47b552dc15448b4e306fcf8df320e5124b2cbd63')
```

#### `cd4pe_deployments::get_pipeline_trigger_event(String $repo_name, String $pipeline_id, String $commit_sha)`

The cd4pe_deployments::get_pipeline_trigger_event function.

Returns: `Hash` contains the results of the function
See [README.md]() for information on the CD4PEFunctionResult hash format
* result [Hash]:
  * `rows [Array] array of hashes with pipeline results. Contains 1 hash for the result of the matching commit SHA`
* error [Hash] contains error information if any

##### Examples

###### Get pipeline trigger event for a repository named 'control-repo'

```puppet
$pipeline = get_pipeline_trigger_event('control-repo', '1mfxk3kc4ic1w0nny0zcq5l7cw', '47b552dc15448b4e306fcf8df320e5124b2cbd63')
```

##### `repo_name`

Data type: `String`

The name of the repository

##### `pipeline_id`

Data type: `String`

The pipelineId of the pipeline

##### `commit_sha`

Data type: `String`

The commit SHA to get the pipeline result for

### <a name="cd4pe_deploymentspartition_nodes"></a>`cd4pe_deployments::partition_nodes`

Type: Ruby 4.x API

Partition nodes in a node group

#### Examples

##### Create a node group then partition

```puppet
$parent_node_group_id = "3ed5c6c0-be33-4c62-9f41-a863a282b6ae"
$test_environment = "development"
$my_node_group = create_temp_node_group($parent_node_group_id, $test_environment, true)
$node_partitions = partition_nodes($my_node_group, 5)
```

#### `cd4pe_deployments::partition_nodes(Hash $node_group, Integer $batch_size)`

The cd4pe_deployments::partition_nodes function.

Returns: `Hash` contains the results of the function
See [README.md]() for information on the CD4PEFunctionResult hash format
* result [Array[Array[String]]] contains partitions of nodes
* error [Hash] contains error information if any

##### Examples

###### Create a node group then partition

```puppet
$parent_node_group_id = "3ed5c6c0-be33-4c62-9f41-a863a282b6ae"
$test_environment = "development"
$my_node_group = create_temp_node_group($parent_node_group_id, $test_environment, true)
$node_partitions = partition_nodes($my_node_group, 5)
```

##### `node_group`

Data type: `Hash`

The node group object.

##### `batch_size`

Data type: `Integer`

Determines the size of each partition

### <a name="cd4pe_deploymentspin_nodes_to_env"></a>`cd4pe_deployments::pin_nodes_to_env`

Type: Ruby 4.x API

Pin a list of nodes to Puppet Enterprise environment group

#### Examples

##### Pin a list of nodes to an environment group

```puppet
$my_cool_node_group_id = "3ed5c6c0-be33-4c62-9f41-a863a282b6ae"
pin_nodes_to_env(["example.node1.net", "example.node2.net", "example.node3.net"], $my_cool_node_group_id)
```

#### `cd4pe_deployments::pin_nodes_to_env(Array $nodes, String $node_group_id)`

The cd4pe_deployments::pin_nodes_to_env function.

Returns: `Hash` contains the results of the function
See [README.md]() for information on the CD4PEFunctionResult hash format
* result [Hash]:
  * success [Boolean] whether or not the pinning succeeded
* error [Hash] contains error information if any

##### Examples

###### Pin a list of nodes to an environment group

```puppet
$my_cool_node_group_id = "3ed5c6c0-be33-4c62-9f41-a863a282b6ae"
pin_nodes_to_env(["example.node1.net", "example.node2.net", "example.node3.net"], $my_cool_node_group_id)
```

##### `nodes`

Data type: `Array`

List of nodes to pin to the group

##### `node_group_id`

Data type: `String`

The ID string of the node group

### <a name="cd4pe_deploymentsrun_puppet"></a>`cd4pe_deployments::run_puppet`

Type: Ruby 4.x API

Run Puppet using the Puppet Orchestrator for a set of nodes in a given environment

#### Examples

##### Run Puppet on nodes in the 'development' environment

```puppet
$my_cool_environment = "development"
$nodes = ["test1.example.com", "test2.example.com", "test3.example.com"]
run_puppet($nodes, false, $my_cool_environment, 2)
```

#### `cd4pe_deployments::run_puppet(Array[String] $nodes, Optional[Boolean] $noop, Optional[String] $environment_name, Optional[Integer] $concurrency)`

The cd4pe_deployments::run_puppet function.

Returns: `Hash` contains the results of the function
See [README.md]() for information on the CD4PEFunctionResult hash format
* result [Hash] This contains data described by the following documentation:
  https://puppet.com/docs/pe/latest/orchestrator_api_jobs_endpoint.html#get-jobs-job-id
* error [Hash] Contains error info if any was encountered during the function call

##### Examples

###### Run Puppet on nodes in the 'development' environment

```puppet
$my_cool_environment = "development"
$nodes = ["test1.example.com", "test2.example.com", "test3.example.com"]
run_puppet($nodes, false, $my_cool_environment, 2)
```

##### `environment_name`

Data type: `Optional[String]`

The name of the Puppet environment to deploy

##### `nodes`

Data type: `Array[String]`

The list of nodes to Run puppet on

##### `noop`

Data type: `Optional[Boolean]`

A Boolean to run Puppet in Noop mode. Defaults to 'false'.

##### `concurrency`

Data type: `Optional[Integer]`

The number of nodes to concurrently run Puppet on. Defaults to the Puppet Orchestrator default.

### <a name="cd4pe_deploymentssearch_impacted_nodes"></a>`cd4pe_deployments::search_impacted_nodes`

Type: Ruby 4.x API

Get information about the impacted nodes of a CD4PE Impact Analysis

#### Examples

##### Get information about a specific environment in a specific IA

```puppet
$impacted_nodes = search_impacted_nodes(517)
```

#### `cd4pe_deployments::search_impacted_nodes(Integer $environment_result_id)`

The cd4pe_deployments::search_impacted_nodes function.

Returns: `Hash` contains the results of the function
See [README.md]() for information on the CD4PEFunctionResult hash format
* result [Hash]:
  * `rows [Array] array of hashes, one for each impacted node`
* error [Hash] contains error information if any

##### Examples

###### Get information about a specific environment in a specific IA

```puppet
$impacted_nodes = search_impacted_nodes(517)
```

##### `environment_result_id`

Data type: `Integer`

The internal environment_result_id of an analysed code environment in the IA

### <a name="cd4pe_deploymentssearch_pipeline"></a>`cd4pe_deployments::search_pipeline`

Type: Ruby 4.x API

Search which recent pipeline(s) match for a given commit SHA for a repository

#### Examples

##### List recent trigger events for a repository named 'control-repo'

```puppet
$pipeline = search_pipeline('control-repo', '47b552dc15448b4e306fcf8df320e5124b2cbd63')
```

#### `cd4pe_deployments::search_pipeline(String $repo_name, String $commit_sha)`

The cd4pe_deployments::search_pipeline function.

Returns: `Hash` contains the results of the function
See [README.md]() for information on the CD4PEFunctionResult hash format
* result [String]: the pipelineId of the found pipeline for the provided commit SHA
* error [Hash] contains error information if any

##### Examples

###### List recent trigger events for a repository named 'control-repo'

```puppet
$pipeline = search_pipeline('control-repo', '47b552dc15448b4e306fcf8df320e5124b2cbd63')
```

##### `repo_name`

Data type: `String`

The name of the repository

##### `commit_sha`

Data type: `String`

The commit SHA to get the pipeline result for

### <a name="cd4pe_deploymentsupdate_git_branch_ref"></a>`cd4pe_deployments::update_git_branch_ref`

Type: Ruby 4.x API

Update a given git branch's HEAD ref to a new commit SHA

#### Examples

##### Update git branch "production" to commit c090ea692e67405c5572af6b2a9dc5f11c9080c0

```puppet
update_git_branch_ref("CONTROL_REPO", "production", "c090ea692e67405c5572af6b2a9dc5f11c9080c0")
```

#### `cd4pe_deployments::update_git_branch_ref(Enum["CONTROL_REPO", "MODULE"] $repo_type, String $branch_name, String $commit_sha)`

The cd4pe_deployments::update_git_branch_ref function.

Returns: `Hash` contains the results of the function
See [README.md]() for information on the CD4PEFunctionResult hash format
* result [Hash]:
  * success [Boolean] whether or not the operation was successful
* error [Hash] contains error information if any

##### Examples

###### Update git branch "production" to commit c090ea692e67405c5572af6b2a9dc5f11c9080c0

```puppet
update_git_branch_ref("CONTROL_REPO", "production", "c090ea692e67405c5572af6b2a9dc5f11c9080c0")
```

##### `repo_type`

Data type: `Enum["CONTROL_REPO", "MODULE"]`

The type of repo to perform the operation on. Must be one of "CONTROL_REPO" or "MODULE".

##### `branch_name`

Data type: `String`

The name of the branch you want to update

##### `commit_sha`

Data type: `String`

The commit SHA that will become the branch's new HEAD

### <a name="cd4pe_deploymentsvalidate_code_deploy_status"></a>`cd4pe_deployments::validate_code_deploy_status`

Type: Puppet Language

This is a helper function to be used with the result from the `deploy_code` function.
It will take the result from a code deploy and return an error hash if an error occurred or if
any of the code deployments failed.

#### `cd4pe_deployments::validate_code_deploy_status(Hash $deploy_code_result)`

The cd4pe_deployments::validate_code_deploy_status function.

Returns: `Hash` contains the results of the code deployment

##### `deploy_code_result`

Data type: `Hash`

The results of the code deployment from calling the `deploy_code` function.
See the `deploy_code` docs for more info on the value of this object

### <a name="cd4pe_deploymentswait_for_approval"></a>`cd4pe_deployments::wait_for_approval`

Type: Ruby 4.x API

Blocks further plan execution until the deployment is approved in CD4PE and takes a lambda that is executed once
at the start of the wait time. The lambda includes the "url" which is a link to the approval page for the deployment. If
the max approval window is exceeded (24 hours) or approval is declined, a Bolt::PlanFailure is raised, otherwise a result
is returned to the user.

#### Examples

##### Notify Slack users that approval is needed

```puppet
wait_for_approval("development") |String $url| {
  run_task("slack::notify", "#it-ops", "Please review this deployment for approval: ${url}")
}
```

#### `cd4pe_deployments::wait_for_approval(String $environment_name, Callable &$block)`

Blocks further plan execution until the deployment is approved in CD4PE and takes a lambda that is executed once
at the start of the wait time. The lambda includes the "url" which is a link to the approval page for the deployment. If
the max approval window is exceeded (24 hours) or approval is declined, a Bolt::PlanFailure is raised, otherwise a result
is returned to the user.

Returns: `Hash` contains the results of the function
See [README.md]() for information on the CD4PEFunctionResult hash format
* result [Hash]:
  * approvalDecision [Enum['APPROVED', 'DECLINED']] whether the deployment was approved or declined
* error [Hash] contains error information if any

##### Examples

###### Notify Slack users that approval is needed

```puppet
wait_for_approval("development") |String $url| {
  run_task("slack::notify", "#it-ops", "Please review this deployment for approval: ${url}")
}
```

##### `environment_name`

Data type: `String`



##### `&block`

Data type: `Callable`

Takes a block that provides the URL to the deployment's approval page

## Plans

### <a name="cd4pe_deploymentscd4pe_job"></a>`cd4pe_deployments::cd4pe_job`

The cd4pe_deployments::cd4pe_job class.

#### Parameters

The following parameters are available in the `cd4pe_deployments::cd4pe_job` plan:

* [`targets`](#targets)
* [`job_instance_id`](#job_instance_id)
* [`cd4pe_web_ui_endpoint`](#cd4pe_web_ui_endpoint)
* [`cd4pe_job_owner`](#cd4pe_job_owner)
* [`env_vars`](#env_vars)
* [`docker_image`](#docker_image)
* [`docker_run_args`](#docker_run_args)
* [`docker_pull_creds`](#docker_pull_creds)
* [`base_64_ca_cert`](#base_64_ca_cert)
* [`secret_env_vars`](#secret_env_vars)

##### <a name="targets"></a>`targets`

Data type: `TargetSpec`



##### <a name="job_instance_id"></a>`job_instance_id`

Data type: `String[1]`



##### <a name="cd4pe_web_ui_endpoint"></a>`cd4pe_web_ui_endpoint`

Data type: `String[1]`



##### <a name="cd4pe_job_owner"></a>`cd4pe_job_owner`

Data type: `String[1]`



##### <a name="env_vars"></a>`env_vars`

Data type: `Optional[Array[String[1]]]`



Default value: ``undef``

##### <a name="docker_image"></a>`docker_image`

Data type: `Optional[String[1]]`



Default value: ``undef``

##### <a name="docker_run_args"></a>`docker_run_args`

Data type: `Optional[Array[String[1]]]`



Default value: ``undef``

##### <a name="docker_pull_creds"></a>`docker_pull_creds`

Data type: `Optional[String[1]]`



Default value: ``undef``

##### <a name="base_64_ca_cert"></a>`base_64_ca_cert`

Data type: `Optional[String[1]]`



Default value: ``undef``

##### <a name="secret_env_vars"></a>`secret_env_vars`

Data type: `Optional[Array[String[1]]]`



Default value: `[]`

### <a name="cd4pe_deploymentsdirect"></a>`cd4pe_deployments::direct`

This deployment policy will deploy a source commit to the Puppet environment
associated with the Deployment's configured Node Group. It will then run Puppet
on all nodes in the environemnt.

#### Parameters

The following parameters are available in the `cd4pe_deployments::direct` plan:

* [`max_node_failure`](#max_node_failure)
* [`noop`](#noop)
* [`fail_if_no_nodes`](#fail_if_no_nodes)

##### <a name="max_node_failure"></a>`max_node_failure`

Data type: `Integer[0]`

The number of allowed failed Puppet runs that can occur before the Deployment will fail

Default value: `0`

##### <a name="noop"></a>`noop`

Data type: `Boolean`

Indicates if the Puppet run should be a noop.

Default value: ``false``

##### <a name="fail_if_no_nodes"></a>`fail_if_no_nodes`

Data type: `Boolean`

Toggles between failing or silently succeeding when the target environment group has no nodes.

Default value: ``true``

### <a name="cd4pe_deploymentseventual_consistency"></a>`cd4pe_deployments::eventual_consistency`

This deployment policy will perform a Puppet code deploy of the commit
associated with a Pipeline run. Puppet nodes that are scheduled to run regularly will then pick up the
change until all nodes in the target environment are running against the new
code.

### <a name="cd4pe_deploymentsfeature_branch"></a>`cd4pe_deployments::feature_branch`

This deployment policy plan will perform a code deployment of an environment that
matches the source branch for a commit. For Module deployments the plan will create
a feature branch on the control repo that matches the source branch on the Module.
The plan will then deploy the target environment that matches the source branch.

### <a name="cd4pe_deploymentsrolling"></a>`cd4pe_deployments::rolling`

This deployment policy will deploy the target control repository commit to
target nodes in batches. It will create a temporary Puppet environment and
temporary node group to pull nodes out of the target environment and into
the temporary environment while the deployment is taking place.
When the change has been deployed to all of the target nodes, the target
Puppet environment is updated with the change and all the nodes are moved
back to the original node group.
When the deployment is complete, the temporary node group and temporary
Puppet environment are deleted, even if the deployment fails.

#### Parameters

The following parameters are available in the `cd4pe_deployments::rolling` plan:

* [`max_node_failure`](#max_node_failure)
* [`batch_size`](#batch_size)
* [`noop`](#noop)
* [`batch_delay`](#batch_delay)
* [`fail_if_no_nodes`](#fail_if_no_nodes)

##### <a name="max_node_failure"></a>`max_node_failure`

Data type: `Optional[Integer]`

The number of allowed failed Puppet runs that can occur before the Deployment will fail

##### <a name="batch_size"></a>`batch_size`

Data type: `Integer`

The number of nodes in each batch to run Puppet on.

Default value: `10`

##### <a name="noop"></a>`noop`

Data type: `Boolean`

Indicates if the Puppet run should be a noop.

Default value: ``false``

##### <a name="batch_delay"></a>`batch_delay`

Data type: `Integer`

The delay in seconds between each batch.

Default value: `60`

##### <a name="fail_if_no_nodes"></a>`fail_if_no_nodes`

Data type: `Boolean`

Toggles between failing or silently succeeding when the target environment group has no nodes.

Default value: ``true``

